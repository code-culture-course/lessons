"""
Мини-проект Шаг 3: Сохранение в файл

Что мы изучаем:
- Запись данных в текстовый файл
- Чтение данных из текстового файла
- Загрузка сохранённых данных при запуске программы

Теперь задачи сохраняются между запусками!
"""

TASKS_FILE = "tasks.txt"

# Глобальный список для хранения задач
tasks = []


def load_tasks():
    """Загрузить задачи из файла если он существует."""
    global tasks
    try:
        file = open(TASKS_FILE, "r")
        # Каждая строка - одна задача
        tasks = [line.strip() for line in file.readlines()]
        file.close()
        print(f"Загружено {len(tasks)} задач(и) из файла.")
    except FileNotFoundError:
        print("Сохранённых задач не найдено. Начинаем с чистого листа.")


def save_tasks():
    """Сохранить все задачи в файл."""
    file = open(TASKS_FILE, "w")
    for task in tasks:
        file.write(task + "\n")
    file.close()


def display_menu():
    """Показать опции меню."""
    print()
    print("=" * 40)
    print("МЕНЕДЖЕР СПИСКА ЗАДАЧ")
    print("=" * 40)
    print("1. Просмотреть задачи")
    print("2. Добавить задачу")
    print("3. Выход")
    print("=" * 40)


def view_tasks():
    """Отобразить все задачи."""
    print()
    if len(tasks) == 0:
        print("Задач пока нет. Добавьте несколько!")
    else:
        print("Ваши задачи:")
        for i, task in enumerate(tasks, 1):
            print(f"  {i}. {task}")


def add_task():
    """Добавить новую задачу и сохранить в файл."""
    task = input("\nВведите описание задачи: ")
    if task.strip():
        tasks.append(task)
        save_tasks()  # Сохранить после добавления
        print(f"✓ Задача добавлена и сохранена!")
    else:
        print("Задача не может быть пустой.")


# Загрузить задачи при запуске
print("Добро пожаловать в Менеджер списка задач!")
load_tasks()

# Главный цикл программы
running = True
while running:
    display_menu()
    choice = input("\nВыберите опцию (1-3): ")
    
    if choice == "1":
        view_tasks()
    elif choice == "2":
        add_task()
    elif choice == "3":
        print("\nДо свидания!")
        running = False
    else:
        print("\nНеверный выбор. Пожалуйста, выберите 1-3.")

print("Спасибо за использование Менеджера списка задач!")

"""
ПОЧЕМУ ЭТО ВАЖНО:

Теперь программа запоминает ваши задачи! Когда вы запустите её снова, ваши
задачи всё ещё там.

Мы сохраняем в простой текстовый файл, по одной задаче на строку. Это работает, но
имеет ограничения:
- Что если мы хотим хранить больше информации (например, статус выполнения)?
- Что если задача содержит символ новой строки?
- Как мы можем поделиться этими данными с другими программами?

JSON решает эти проблемы. Это следующий шаг!
"""
